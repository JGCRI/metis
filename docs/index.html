<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flexible Scale Multi-Sector Modeling • metis</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Flexible Scale Multi-Sector Modeling">
<meta property="og:description" content="Package to process water-energy-land nexus data to different sub-regional levels.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">metis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/metis.vignette.html">SRN Vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<hr>
<p>title: ‘Metis 1.0.0’ tags:</p>
<ul>
<li>sub-region</li>
<li>nexus</li>
<li>water</li>
<li>energy</li>
<li>land authors:</li>
<li>name: Zarrar Khan affiliation: “1” # (Multiple affiliations must be quoted)</li>
<li>name: Thomas Bernard Wild affiliation: “1,2”</li>
<li>name: Chris Vernon affiliation: “1”</li>
<li>name: Mohamad Hejazi affiliation: “1,2”</li>
<li>name: Leon Clarke affiliation: “1,2”</li>
<li>name: Fernando Miralles affiliation: “1,2”</li>
<li>name: Andy miller affiliation: “3”</li>
<li>name: Fekadu Moreda affiliation: “4”</li>
<li>name: Raul Castillo Munoz affiliation: “5”</li>
<li>name: Julia Lacas Bereslawski affiliation: “6”</li>
<li>name: Micaela Suriano affiliation: “7” affiliations:</li>
<li>name: Joint Global Change Research institute, Pacific Northwest National Laboratory (PNNL), College Park, MD 20740, USA index: 1</li>
<li>name: Earth System Science Interdisciplinary Center (ESSIC), University of Maryland, College Park, MD 20740, USA index: 2</li>
<li>name: National Peace Corps Association, Washington, DC 20036, USA index: 3</li>
<li>name: Research Triangle Institute (RTI), Research Triangle Park, NC, 27709-2194, USA index: 4</li>
<li>name: Inter-American Development Bank (IDB), Washington, D.C. 20577, USA index: 5</li>
<li>name: Independent Consultant for the Inter-American Development Bank, Washington, D.C. 20577, USA index: 6</li>
<li>name: Instituto Nacional del Agua (INA), Buenos Aires, Argentina index: 7 date: 10 August 2019 —</li>
</ul>
<!-- badges: start --><p><a href="https://travis-ci.org/JGCRI/metis"><img src="https://travis-ci.org/JGCRI/metis.svg?branch=master" alt="Travis build status"></a> <!-- badges: end --></p>
<p align="center">
<img src="READMEfigs/metisHeaderThin.PNG"></p>
<p align="center">
<img src="READMEfigs/pnnlUMDLogos.PNG"></p>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<div id="contents" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#contents" class="anchor"></a><a name="Contents"></a>Contents</h1></div>
<!-- ------------------------>
<!-- ------------------------>
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Need">Need</a></li>
<li><a href="#Framework">Framework</a></li>
<li><a href="#InstallGuide">Installation Guide</a></li>
<li>
<a href="#WalkThrough">Metis Step-by-step walkthrough</a>
<ul>
<li><a href="#metis.io.R">metis.io.R</a></li>
<li><a href="#metis.readgcam.R">metis.readgcam.R</a></li>
<li><a href="#metis.chart.R">metis.chart.R</a></li>
<li><a href="#metis.chartsProcess.R">metis.chartsProcess.R</a></li>
<li><a href="#metis.map.R">metis.map.R</a></li>
<li><a href="#metis.boundaries.R">metis.boundaries.R</a></li>
<li><a href="#metis.grid2poly.R">metis.grid2poly.R</a></li>
<li><a href="#metis.mapsProcess.R">metis.mapsProcess.R</a></li>
<li><a href="#testing">testing</a></li>
</ul>
</li>
<li><a href="#underDevelopment">Under development</a></li>
</ul>
<!-- ------------------------><!-- ------------------------>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a><a name="Introduction"></a>Introduction</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>The Metis model is a joint effort by the Pacific Northwest National Laboratory (PNNL) and the University of Maryland (UMD). Metis provides a framework allowing analysis of dynamics across multiple sectors including water, energy, land and socio-economics at various spatial and temporal scales. It is designed to be a flexible tool which can take inputs from both global integrated assessment models (IAMs) which capture global dynamics as well as more detailed models which can capture specific sub-regional and sectoral details at finer resolutions. Metis integrates across tools by sharing data in standardized formats.</p>
<p>In most projects looking at multi-sector dynamics one of the key constraints is data availability and a key goal of Metis is to overcome this barrier by providing users with default data across sectors for their specific region. The default data is built from outputs of the open-source Global Change Assessment Model (GCAM) eco-system which provides downscaled gridded global data for water, energy and land. Metis aggregates gridded data to any spatial boundary and offers users a first look at the water-energy-land situation in their regions of interest. The idea is to use this as a starting point and then improve the data as and when it becomes available while working with local stakeholders.</p>
<p>After aggregating data to relevant spatial and temporal scales, Metis finds relationships between the sectors using input/output methods to establish correlation matrices. The correlation matrices represent the inter-sectoral links throughout the system and are then used to investigate impacts of changes in one sector on others.</p>
<p align="center">
<b> Metis - A model to bridge the gap between coarse resolution IAMs and finer-resolution sector specific models </b>
</p>
<p align="center">
<img src="READMEfigs/metis_MidSpatial_MultiSectDynamic.PNG"></p>
<ul>
<li>The Metis modeling development platform is hosted on github at: <a href="https://github.com/JGCRI/Metis" class="uri">https://github.com/JGCRI/Metis</a>
</li>
<li>To clone this repo is: <a href="https://github.com/JGCRI/Metis.git" class="uri">https://github.com/JGCRI/Metis.git</a>
</li>
<li>The model is comprised of an R package and additional files with sample data</li>
</ul>
<!-- ------------------------><!-- ------------------------>
</div>
<div id="need" class="section level1">
<h1 class="hasAnchor">
<a href="#need" class="anchor"></a><a name="Need"></a>Need</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>The motivation behind developing the Metis model is to bridge the gap between models working at different spatial and temporal resolutions. Sector specific details such as diurnal electricity demand profiles and the availability of intermittent technologies are often captured by fine resolution sector specific models. These finer scale models are however often limited in scope to the specific sector in question. With increasing pressures on limited resources from growing populations, technological advances and a changing climate the links across human-earth systems are becoming more critical. These links include feedbacks across system such as water demands for power plant cooling and hydro power; energy demands for water purification, transfers and distribution; both energy and water demands for agriculture production and harvesting; and the impacts of land-use change emissions and water demands as a result of bio-fuel expansion and deforestation. All of these are driven by socio-economic developments and policy decisions across these systems. Global integrated assessment models are often used to capture these broader long-term dynamics on larger spatial and temporal scales. The development of the Metis model will address this need to capture both broader long-term dynamics across systems and global markets as well as sub-regional details. The model will do this by taking global data and dynamics from an IAM such as GCAM and then downscale the results to relevant sub-regional boundaries based on the needs of local stakeholders. The downscaled data will then be refined and calibrated with local sector specific data. This will be followed by calibration of the local inter-sectoral links and the model will then be used for future sector specific policy analysis at the relevant scales while still including global dynamics.</p>
<!-- ------------------------>
<!-- ------------------------>
</div>
<div id="-framework" class="section level1">
<h1 class="hasAnchor">
<a href="#-framework" class="anchor"></a><a name="Framework"></a> Framework</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>Metis is designed to be accesible to a range of stakeholders with varying expertise and goals related to nexus analyses. The various functions of Metis can be used independently for different purposes ranging from visualization, charting, spatial aggregation, mapping and inter-sectoral dynamics. The following lists and figure provides a summary of the existing and planned capabilities of Metis. The lists and figure are updated as progress is made and new developments are planned.</p>
<p align="left">
<b> Metis Module &amp; Functions </b>
</p>
<ul>
<li>Charts: Various functions to produce charts to compare outputs across regions and scenarios (functions: metis.chart.R, metis.chartsProcess.R)</li>
<li>Maps: Various functions to vizualize spatial boundaries and data as rasters and polygon (functions: metis.boundaries.R, metis.map.R, metis.mapsProcess.R)</li>
<li>Spatial Aggregation: Functions to aggregate gridded data to different spatial boundaries. (functions: metis.grid2poly.R)</li>
<li>Data preparation: Functions to prepare data from other modules into the appropriate format. (functions: metis.readgcam.R, metis.prepGrid.R)</li>
<li>Input/Output (IO) Analysis: Functions to build IO inter-sectoral tables and sankey diagrams. (functions: metis.io.R)</li>
</ul>
<p align="left">
<b> Under Development </b>
</p>
<ul>
<li>Flows: Module to route water through upstream and downstream sub-regions.</li>
<li>Infrastructure: Optimization module to find infrastructure development options to address supply-demand gaps. (functions: metis.infra.R)</li>
</ul>
<p align="center">
<img src="READMEfigs/metis_workflow1.png"></p>
<!-- ------------------------>
<!-- ------------------------>
</div>
<div id="installation-guide" class="section level1">
<h1 class="hasAnchor">
<a href="#installation-guide" class="anchor"></a><a name="InstallGuide"></a>Installation Guide</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<ol>
<li>Clone the repo from github:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="r"># Download a git software (eg. https://git-scm.com/downloads) to clone the repo
git clone https://github.com/JGCRI/metis.git

# Or download directly from github https://github.com/JGCRI/metis</pre></div>
<ol>
<li>
<p>Download and install:</p>
<ul>
<li>R (<a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a>)</li>
<li>R studio (<a href="https://www.rstudio.com/" class="uri">https://www.rstudio.com/</a>)</li>
<li>(For Windows) Rtools (<a href="https://cran.rstudio.com/bin/windows/Rtools/" class="uri">https://cran.rstudio.com/bin/windows/Rtools/</a>)</li>
<li>Image Magick (<a href="https://imagemagick.org/script/download.php" class="uri">https://imagemagick.org/script/download.php</a>)</li>
</ul>
</li>
<li><p>Open the metis.Rproj file.</p></li>
<li><p>Open the “metis.master.R”" file which contains code to help install and run remaining model.</p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co">#----------------------------</span>
<span class="co"># Install necessary packages</span>
<span class="co">#----------------------------</span>

<span class="co"># Devtools</span>
<span class="co"># ---------</span>
<span class="co"># For updated instructions and additional operating systems see: </span>
<span class="co"># https://www.rstudio.com/products/rpackages/devtools/</span>
<span class="co"># https://johnmuschelli.com/neuroc/installing_devtools/index.html</span>
<span class="co"># Windows: no additional steps</span>
<span class="co"># UBUNTU: sudo apt-get install build-essential libcurl4-gnutls-dev libxml2-dev libssl-dev</span>

<span class="co"># GDAL</span>
<span class="co"># --------</span>
<span class="co"># For updated instructions and additional operating systems see: </span>
<span class="co"># https://github.com/r-spatial/sf/</span>
<span class="co"># https://gdal.org/download.html</span>
<span class="co"># Windows: no additional steps</span>
<span class="co"># UBUNTU: </span>
<span class="co"># sudo add-apt-repository ppa:ubuntugis/ubuntugis-unstable</span>
<span class="co"># sudo apt-get update</span>
<span class="co"># sudo apt-get install libudunits2-dev libgdal-dev libgeos-dev libproj-dev</span>
<span class="co"># MacOS (Using homebrew):</span>
<span class="co"># brew install pkg-config</span>
<span class="co"># brew install gdal</span>

<span class="co"># Image Magick</span>
<span class="co"># -------------</span>
<span class="co"># For updated instructions and additional operating systems see: </span>
<span class="co"># https://cran.r-project.org/web/packages/magick/vignettes/intro.html</span>
<span class="co"># Windows: no additional steps</span>
<span class="co"># UBUNTU: sudo apt-get install libmagick++-dev</span>
<span class="co"># MacOS (Using Homebrew): brew install imagemagick@6</span>

<span class="kw">if</span>(<span class="st">"devtools"</span> <span class="kw">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span>()) <span class="kw">==</span> <span class="no">F</span>){<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)}; <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">devtools</span>)
<span class="kw">if</span>(<span class="st">"rgcam"</span> <span class="kw">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span>()) <span class="kw">==</span> <span class="no">F</span>){<span class="fu"><a href="https://rdrr.io/pkg/devtools/man/reexports.html">install_github</a></span>(<span class="kw">repo</span><span class="kw">=</span><span class="st">"JGCRI/rgcam"</span>)}; <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgcam</span>)
<span class="kw">if</span>(<span class="st">"metis"</span> <span class="kw">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span>()) <span class="kw">==</span> <span class="no">F</span>){<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/install.html">install</a></span>()}; <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">metis</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggalluvial</span>);<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>);<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>);<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rgdal</span>)</pre></div>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<p align="center">
<b> Metis Initial Folders </b>
</p>
<p align="center">
<img src="READMEfigs/metis_initialFolders.PNG"></p>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metis-step-by-step-walkthrough" class="section level1">
<h1 class="hasAnchor">
<a href="#-metis-step-by-step-walkthrough" class="anchor"></a><a name="WalkThrough"></a> Metis Step-by-step Walkthrough</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>This section walks through the different features of the metis package using the example data provided in order to familiarize the user with the different functions. The following sections describes different functions within the metis package and provides example code to test out the functionality. The same code for each function is also available as a single script in the metis.master.R file in the metis parent directory. All metis R functions are stored in ./metis/R. The key functions available are:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>metis.io.R</td>
<td>This function is designed to interact specifically with GCAM outputs. The function processes GCAM outputs into .csv files by GCAM region which can then be used as inputs to metis.chartsProcess.R</td>
</tr>
<tr class="even">
<td>metis.readgcam.R</td>
<td>This functions is designed to interact specifically with GCAM outputs. The function processes GCAM outputs into .csv files by GCAM region which can then be used as inputs to metis.chartsProcess.R</td>
</tr>
<tr class="odd">
<td>metis.chart.R</td>
<td>metis charting function which allows quick and easy access to features like facets, labels and colors. The function is based on ggplot and returns a ggplot chart.</td>
</tr>
<tr class="even">
<td>metis.chartsProcess.R</td>
<td>metis charting function used to compare scenarios and regions. The function also creates diff plots with percentage and absolute differences from a given reference scenario.</td>
</tr>
<tr class="odd">
<td>metis.map.R</td>
<td>metis mapping function to plot raster and polygon data. The function uses the tmap package and returns a tmap object. Several maps can be combined by overlaying and underlaying using this function. Options allow for different colors palettes, labels, text-size as well as legend breaks which are freescale, kmeans or equally divided to highlight different kinds of data.</td>
</tr>
<tr class="even">
<td>metis.boundaries.R</td>
<td>metis mapping function to plot shape file boundaries and surrounding regions for quick visualization of region of interest.</td>
</tr>
<tr class="odd">
<td>metis.grid2poly.R</td>
<td>Function used to crop and aggregate gridded data by a given polygon shape file. If no grid is provided the function can still be used to produce regional and subregional maps</td>
</tr>
<tr class="even">
<td>metis.mapsProcess.R</td>
<td>metis mapping function used to compare across scenarios. The function produces diff maps with percentage and absolute differences from a given reference scenario.</td>
</tr>
<tr class="odd">
<td>metis.prepGrid.R</td>
<td>This function is designed to be used with specific open-source downscaling models Xanthos, Demeter and Tethys which downscale GCAM data to the grid level. The function takes outputs from these various models and processes them into the metis format which is then used as an input to the metis.mapsProcess.R function.</td>
</tr>
<tr class="even">
<td>metis.assumptions.R</td>
<td>Contains all conversions and assumptions used in the model</td>
</tr>
<tr class="odd">
<td>metis.colors.R</td>
<td>Collection of metis color palettes. A list of palettes can be viewed in the function help file (?metis.colors). To view a particular palette metis.colors(“pal_hot”)</td>
</tr>
</tbody>
</table>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<p align="center">
<b> Metis Functions </b>
</p>
<p align="center">
<img src="READMEfigs/metis_functions.PNG"></p>
<p>The workflow for data processing, charting and mapping is shown below. The following subsections will guide the user through each of these processes further expaning on the functionality within each of the functions.</p>
<p align="center">
<b> Metis charts, maps and IO workflows </b>
</p>
<p align="center">
<img src="READMEfigs/metis_workflowChart.png"></p>
<p align="center">
<img src="READMEfigs/metis_workflowMap.png"></p>
<p align="center">
<img src="READMEfigs/metis_workflowIO.png"></p>

</details><!-- ------------------------><!-- ------------------------><div id="-metisio" class="section level2">
<h2 class="hasAnchor">
<a href="#-metisio" class="anchor"></a><a name="metis.io"></a> metis.io</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p><b> Key Inputs </b></p>
<ul>
<li>ioTable0: An input-output table with flow of commodity from a “supplySector” or “supplySubSector” to other sectors.</li>
</ul>
<p>metis.io.R is the Metis function to analyze inter-sectoral intensities. metis.io.R uses an input/output methodology [4] to calculate linear intensity co-efficient matrices. The function accepts a table of values giving flows of commodities labelled “supplySector” to any number of other sectors including the “supplySector” categories. The function then finds inter-sectoral links by analyzing the flows from given supply sectors to other supply sector categories within the region. Outputs of the function include tables, bubble charts and Sankey diagrams showing the intensity matrices and inter-sectoral links as shown in the example figures below.</p>
<p align="center">
<b> metis.io.R examples (a) Sankey diagram (b) Inter-sectoral intensity matrix as a bubble chart </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleIO1.PNG"></p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="co">#----------------------------</span>
<span class="co"># Input/Output (metis.io.R)</span>
<span class="co">#---------------------------</span>

<span class="co"># IO test 1 - Simple</span>
    <span class="no">ioTable0</span><span class="kw">=</span><span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>( <span class="co"># Initial Flows</span>
      ~<span class="no">supplySubSector</span>,  ~<span class="no">water</span>,  ~<span class="no">ag</span>,   ~<span class="no">elec</span>,  ~<span class="no">domestic</span>, ~<span class="no">export</span>, ~<span class="no">mining</span>, ~<span class="no">other</span>, ~<span class="no">units</span>,
      <span class="st">"water"</span>,            <span class="fl">0</span>,    <span class="fl">30</span>,      <span class="fl">5</span>,        <span class="fl">8</span>,         <span class="fl">5</span>,       <span class="fl">5</span>,    <span class="fl">5</span>, <span class="st">"km3"</span>,
      <span class="st">"ag"</span>,               <span class="fl">0</span>,    <span class="fl">0</span>,      <span class="fl">1</span>,        <span class="fl">0</span>,          <span class="fl">10</span>,      <span class="fl">0</span>,    <span class="fl">0</span>, <span class="st">"ton"</span>,
      <span class="st">"elec"</span>,             <span class="fl">3</span>,    <span class="fl">0.3</span>,    <span class="fl">0</span>,        <span class="fl">0.5</span>,        <span class="fl">1</span>,       <span class="fl">2</span>,    <span class="fl">5</span>, <span class="st">"TWh"</span>,
      <span class="st">"livestock"</span>,        <span class="fl">1</span>,    <span class="fl">0.1</span>,    <span class="fl">0</span>,        <span class="fl">0.3</span>,        <span class="fl">2</span>,       <span class="fl">3</span>,    <span class="fl">2</span>, <span class="st">"head"</span>);<span class="no">ioTable0</span>


    <span class="no">io</span><span class="kw">&lt;-</span><span class="fu"><a href="reference/metis.io.html">metis.io</a></span>(<span class="kw">ioTable0</span> <span class="kw">=</span> <span class="no">ioTable0</span>, <span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>,<span class="kw">plotSankeys</span><span class="kw">=</span><span class="no">T</span>, <span class="kw">nameAppend</span> <span class="kw">=</span> <span class="st">"_testSimple"</span>)
    <span class="co"># View Outputs</span>
    <span class="no">io</span>$<span class="no">A</span>
    <span class="no">io</span>$<span class="no">L</span>
    <span class="no">io</span>$<span class="no">ioTbl</span>


<span class="co"># IO test 2 with subSectors</span>
    <span class="no">ioTable0</span><span class="kw">=</span><span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>( <span class="co"># Initial Flows</span>
      ~<span class="no">supplySubSector</span>,  ~<span class="no">supplySector</span>, ~<span class="no">w_GW</span>,  ~<span class="no">ag_Wheat</span>,   ~<span class="no">elec_Coal</span>,  ~<span class="no">domestic</span>, ~<span class="no">export</span>, ~<span class="no">mining</span>, ~<span class="no">other</span>, ~<span class="no">units</span>,
      <span class="st">"w_GW"</span>,            <span class="st">"water"</span>,     <span class="fl">0</span>,    <span class="fl">10</span>,      <span class="fl">1</span>,        <span class="fl">3</span>,         <span class="fl">1</span>,       <span class="fl">2</span>,    <span class="fl">1</span>, <span class="st">"km3"</span>,
      <span class="st">"w_SW"</span>,            <span class="st">"water"</span>,     <span class="fl">0</span>,    <span class="fl">30</span>,      <span class="fl">5</span>,        <span class="fl">8</span>,         <span class="fl">5</span>,       <span class="fl">5</span>,    <span class="fl">5</span>, <span class="st">"km3"</span>,
      <span class="st">"ag_Biofuel"</span>,      <span class="st">"ag"</span>,        <span class="fl">0</span>,    <span class="fl">0</span>,       <span class="fl">2</span>,        <span class="fl">0</span>,         <span class="fl">8</span>,       <span class="fl">0</span>,    <span class="fl">0</span>, <span class="st">"ton"</span>,
      <span class="st">"ag_Wheat"</span>,        <span class="st">"ag"</span>,        <span class="fl">0</span>,    <span class="fl">0</span>,       <span class="fl">0</span>,        <span class="fl">6</span>,         <span class="fl">9</span>,       <span class="fl">0</span>,    <span class="fl">0</span>, <span class="st">"ton"</span>,
      <span class="st">"ag_Rice"</span>,         <span class="st">"ag"</span>,        <span class="fl">0</span>,    <span class="fl">0</span>,       <span class="fl">0</span>,        <span class="fl">5</span>,         <span class="fl">20</span>,      <span class="fl">0</span>,    <span class="fl">0</span>, <span class="st">"ton"</span>,
      <span class="st">"elec_Coal"</span>,       <span class="st">"elec"</span>,      <span class="fl">3</span>,    <span class="fl">0.3</span>,     <span class="fl">0</span>,        <span class="fl">0.6</span>,       <span class="fl">1</span>,       <span class="fl">3</span>,    <span class="fl">6</span>, <span class="st">"TWh"</span>,
      <span class="st">"elec_Wind"</span>,       <span class="st">"elec"</span>,      <span class="fl">2</span>,    <span class="fl">0.2</span>,     <span class="fl">0</span>,        <span class="fl">0.4</span>,       <span class="fl">0.677</span>,   <span class="fl">2</span>,    <span class="fl">4</span>, <span class="st">"TWh"</span>,
      <span class="st">"elec_Oil"</span>,        <span class="st">"elec"</span>,      <span class="fl">1</span>,    <span class="fl">0.1</span>,     <span class="fl">0</span>,        <span class="fl">0.2</span>,       <span class="fl">0.333</span>,   <span class="fl">1</span>,    <span class="fl">2</span>, <span class="st">"TWh"</span>,
      <span class="st">"livestock_Cow"</span>,   <span class="st">"livestock"</span>, <span class="fl">0</span>,    <span class="fl">0</span>,       <span class="fl">0</span>,        <span class="fl">0</span>,         <span class="fl">30</span>,      <span class="fl">60</span>,   <span class="fl">0</span>, <span class="st">"head"</span>,
      <span class="st">"livestock_Chicken"</span>,<span class="st">"livestock"</span>,<span class="fl">0</span>,    <span class="fl">0</span>,       <span class="fl">0</span>,        <span class="fl">0</span>,         <span class="fl">50</span>,      <span class="fl">90</span>,   <span class="fl">0</span>, <span class="st">"head"</span>);<span class="no">ioTable0</span>


    <span class="no">io_sub</span><span class="kw">&lt;-</span><span class="fu"><a href="reference/metis.io.html">metis.io</a></span>(<span class="kw">ioTable0</span> <span class="kw">=</span> <span class="no">ioTable0</span>, <span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>,<span class="kw">plotSankeys</span><span class="kw">=</span><span class="no">T</span>, <span class="kw">nameAppend</span> <span class="kw">=</span> <span class="st">"_testSubSector"</span>)
    <span class="co"># View Outputs</span>
    <span class="no">io_sub</span>$<span class="no">A</span>
    <span class="no">io_sub</span>$<span class="no">L</span>
    <span class="no">io_sub</span>$<span class="no">ioTbl</span></pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metisreadgcamr" class="section level2">
<h2 class="hasAnchor">
<a href="#-metisreadgcamr" class="anchor"></a><a name="metis.readgcam.R"></a> metis.readgcam.R</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p><b> Key Inputs </b></p>
<ul>
<li>GCAM data: A gcamdatabase OR a gcamdata “.proj”" file (with complete paths)</li>
<li>Query File: An “.xml” query file (with complete paths)</li>
</ul>
<p>The model comes with an example gcamdatabase “.proj” file called “Example_dataProj.proj” which lies in the folder metis/dataFiles/gcam/ as shown in the figure below. It is recommended that other gcamdatabases are also kept in this folder. GCAM produces an output in the form of a database. The database contains outputs from various scenario runs. “metis.readgcam” uses another package “rgcam” to connects with the gcam database and retrieves data based on “queries” provided in an “.xml” file. Often scenario names in the model can be long and not appropriate for final figures. This function allows you to rename the scenarios as they are read in. Once the data has been extracted from a gcam database it is saved in a “.proj” file. Reading data from the gcam database can take a considerable amount of time depending on the number of scenarios it contains. The “metis.readgcam” function gives the option of directly providing a “.proj” which can be loaded directly or using the “.proj” file from a previous run by setting the parameter “reReadData” to FALSE. If “reReadData” is set to FALSE the function will first search for a user provided “.proj” file (which is entered in the param “dataProj”), then in the “inputs/gcam” folder and if it doesn’t exist will give an error message. If “reReadData” is set to TRUE then the function will create a file called “dataProj.proj” in the same folder as the GCAM database. The code below shows how to read in data using the database or .proj file. The user can choose the regions of interest.</p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<p align="center">
<b> GCAM data </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleGCAM1.png"></p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="co">#----------------------------</span>
<span class="co"># Read GCAM Data (metis.readgcam.R)</span>
<span class="co">#---------------------------</span>


<span class="co"># There are two ways to read GCAM data</span>
    <span class="co"># i. gcamdatabase:        Directly connecting to a gcam database and extracting data using queries</span>
    <span class="co">#                         which are then saved to a .proj file</span>
    <span class="co"># ii. .proj or .dat file: If a proj file has alreayd been created or saved from a previous run of rgcam</span>
    <span class="co">#                         then metis can take connect directly to this data.</span>

<span class="co"># Connect to gcam database .proj or .dat file</span>
    <span class="co"># This is data that has already been extracted from a gcamdatabse using queries and rgcam</span>
    <span class="co"># and is thus much faster to process than connecting directly to the gcamdatabase.</span>
    <span class="co"># The data must have been extracted using queries that are available in metisQueries.xml</span>
      <span class="no">dataProjPath_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gcam"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>) <span class="co"># Path to dataProj file.</span>
      <span class="no">dataProj_i</span> <span class="kw">&lt;-</span><span class="st">"Example_dataProj.proj"</span>  <span class="co"># Use if gcamdata has been saved as .proj file</span>

    <span class="co"># Get list of scenarios and rename if desired.</span>
      <span class="no">dataProjLoaded</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rgcam/man/loadProject.html">loadProject</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">dataProjPath_i</span>, <span class="st">"/"</span>,<span class="no">dataProj_i</span> , <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))
      <span class="fu"><a href="https://rdrr.io/pkg/rgcam/man/listScenarios.html">listScenarios</a></span>(<span class="no">dataProjLoaded</span>)  <span class="co"># List of Scenarios in GCAM database</span>

    <span class="co"># Scenario names</span>
      <span class="no">scenOrigNames_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ExampleScen1"</span>,<span class="st">"ExampleScen2"</span>)
      <span class="no">scenNewNames_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Eg1"</span>,<span class="st">"Eg2"</span>)  <span class="co"># Names to replace the original names for final figures.</span>

    <span class="co"># Choose Parameters or set to "All" for all params. For complete list see ?metis.readgcam</span>
      <span class="no">paramsSelect_i</span> <span class="kw">=</span> <span class="st">"All"</span>

    <span class="co"># Select regions from the 32 GCAM regions.</span>
      <span class="no">regionsSelect_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Argentina"</span>,<span class="st">"Colombia"</span>)

      <span class="no">dataGCAM</span><span class="kw">&lt;-</span><span class="fu"><a href="reference/metis.readgcam.html">metis.readgcam</a></span>(<span class="kw">reReadData</span> <span class="kw">=</span> <span class="no">F</span>,
                             <span class="co">#gcamdatabasePath = gcamdatabasePath_i,</span>
                             <span class="co">#gcamdatabaseName = gcamdatabaseName_i,</span>
                             <span class="kw">scenOrigNames</span> <span class="kw">=</span> <span class="no">scenOrigNames_i</span>,
                             <span class="kw">scenNewNames</span> <span class="kw">=</span> <span class="no">scenNewNames_i</span>,
                             <span class="kw">dataProj</span> <span class="kw">=</span> <span class="no">dataProj_i</span>,
                             <span class="kw">dataProjPath</span> <span class="kw">=</span> <span class="no">dataProjPath_i</span>,
                             <span class="kw">regionsSelect</span> <span class="kw">=</span> <span class="no">regionsSelect_i</span> ,
                             <span class="kw">paramsSelect</span><span class="kw">=</span><span class="no">paramsSelect_i</span>
                           )

      <span class="no">dataGCAM</span>$<span class="no">data</span> <span class="co"># To view the data read that was read.</span>

<span class="co"># If connecting directly to a gcamdatabase then can use the following method.</span>
<span class="co"># Uncomment the following lines of code (use ctrl+C to uncomment multiple lines together)</span>
    <span class="co"># # Connect directly to a gcam database and produce a .proj file for future uses.</span>
    <span class="co"># gcamdatabasePath_i &lt;-paste(getwd(),"/dataFiles/gcam",sep="") # Use if gcamdatabase is needed</span>
    <span class="co"># gcamdatabaseName_i &lt;-"example_database_basexdb" # Replace with your database</span>
    <span class="co"># rgcam::localDBConn(gcamdatabasePath_i,gcamdatabaseName_i) # Note names of scenarios</span>
    <span class="co">#</span>
    <span class="co"># # The data must have been extracted using queries that are available in metisQueries.xml</span>
    <span class="co"># dataProjPath_i &lt;- paste(getwd(),"/dataFiles/gcam",sep="") # Path to dataProj file.</span>
    <span class="co"># dataProj_i &lt;-"Example_dataProjGCAM.proj"  # Use if gcamdata has been saved as .proj file</span>
    <span class="co">#</span>
    <span class="co"># # Scenario names</span>
    <span class="co"># scenOrigNames_i = c("ExampleScen1","ExampleScen2") # make sure these exist (See outputs of the rgcam::localDBConn)</span>
    <span class="co"># scenNewNames_i = c("Eg1","Eg2")  # Names to replace the original names for final figures.</span>
    <span class="co">#</span>
    <span class="co"># # Choose Parameters or set to "All" for all params. For complete list see ?metis.readgcam</span>
    <span class="co"># paramsSelect_i = "All"</span>
    <span class="co">#</span>
    <span class="co"># # Select regions from the 32 GCAM regions.</span>
    <span class="co"># regionsSelect_i &lt;- c("Argentina","Colombia")</span>
    <span class="co">#</span>
    <span class="co"># dataGCAM&lt;-metis.readgcam(reReadData = T,</span>
    <span class="co">#                          gcamdatabasePath = gcamdatabasePath_i,</span>
    <span class="co">#                          gcamdatabaseName = gcamdatabaseName_i,</span>
    <span class="co">#                          scenOrigNames = scenOrigNames_i,</span>
    <span class="co">#                          scenNewNames = scenNewNames_i,</span>
    <span class="co">#                          dataProj = dataProj_i,</span>
    <span class="co">#                          dataProjPath = dataProjPath_i,</span>
    <span class="co">#                          regionsSelect = regionsSelect_i ,</span>
    <span class="co">#                          paramsSelect=paramsSelect_i</span>
    <span class="co"># )</span>
    <span class="co">#</span>
    <span class="co"># dataGCAM$data # To view the data read that was read.</span></pre></div>
<p>The function metis.readgcam() returns a list which contains a dataframe with the values it read from the database. In this case it is saved in the variable dataGCAM. The function also creates a new folder “outputs” and stores GCAM data tables in this folder. The function will save the data as a .csv file for each region and one .csv for all regions. Tables with “aggClass” aggregate data across classes to provided sector summaries. In addition the function will produce an empty template data table for each region to be shared with local stakeholders so they can fill in their data. If not specified then all these tables will by default go to a folder called ./metis/outputs/readGCAMTables as shown in the figure below. Once the empty template tables are filled with appropriate local data these can be saved in the folder outputs/Tables/Tables_Local.</p>
<p align="center">
<b> GCAM data tables</b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleGCAM2.png"></p>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metischartr" class="section level2">
<h2 class="hasAnchor">
<a href="#-metischartr" class="anchor"></a><a name="metis.chart.R"></a> metis.chart.R</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>metis.chart.R is the metis charting software used in metis.chartsProcess.R. It allows users to create line, bar, bubble and sankey charts. The default settings maintain a conistent look across the metis products.</p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<p>The following section shows some basic example to use metis.chart.R.</p>
<div class="sourceCode" id="cb5"><pre class="r">
<span class="co">#----------------------------</span>
<span class="co"># Charts Basic (metis.chart.R)</span>
<span class="co">#---------------------------</span>

<span class="co"># Simple example with progressively more features</span>
   <span class="no">tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span> (
   ~<span class="no">x</span>,     ~<span class="no">value</span>,
   <span class="fl">2010</span>,   <span class="fl">15</span>,
   <span class="fl">2020</span>,   <span class="fl">20</span>,
   <span class="fl">2030</span>,   <span class="fl">30</span>
   )
   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">tbl</span>, <span class="kw">xData</span> <span class="kw">=</span> <span class="st">"x"</span>, <span class="kw">yData</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">chartType</span> <span class="kw">=</span> <span class="st">"line"</span>, <span class="kw">fileName</span> <span class="kw">=</span> <span class="st">"chart_eg_line"</span>, <span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>)
   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">tbl</span>, <span class="kw">xData</span> <span class="kw">=</span> <span class="st">"x"</span>, <span class="kw">yData</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">chartType</span> <span class="kw">=</span> <span class="st">"bar"</span>, <span class="kw">fileName</span> <span class="kw">=</span> <span class="st">"chart_eg_bar"</span>, <span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>)
   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">tbl</span>, <span class="kw">xData</span> <span class="kw">=</span> <span class="st">"x"</span>, <span class="kw">yData</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">chartType</span> <span class="kw">=</span> <span class="st">"bar"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"blue"</span>,<span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>,
               <span class="kw">yLabel</span> <span class="kw">=</span> <span class="st">"New y Label"</span>, <span class="kw">xLabel</span> <span class="kw">=</span> <span class="st">"New X label"</span>, <span class="kw">fileName</span> <span class="kw">=</span> <span class="st">"chart_eg_bar_blue"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Title"</span>)
   <span class="co"># See ?metis.chart for more details on further customization eg. tick marks, title size ect.</span>

<span class="co"># More detailed data with facets</span>
   <span class="co"># Simple example with progressively more features</span>
   <span class="no">tbl_multi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span> (
     ~<span class="no">x</span>,     ~<span class="no">value</span>, ~<span class="no">region</span>,     ~<span class="no">scen</span>,   ~<span class="no">fuel</span>,
     <span class="fl">2010</span>,   <span class="fl">25</span>,     <span class="st">"region1"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2020</span>,   <span class="fl">30</span>,     <span class="st">"region1"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2030</span>,   <span class="fl">40</span>,     <span class="st">"region1"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2010</span>,   <span class="fl">25</span>,     <span class="st">"region2"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2020</span>,   <span class="fl">10</span>,     <span class="st">"region2"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2030</span>,   <span class="fl">60</span>,     <span class="st">"region2"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2010</span>,   <span class="fl">75</span>,     <span class="st">"region1"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2020</span>,   <span class="fl">30</span>,     <span class="st">"region1"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2030</span>,   <span class="fl">20</span>,     <span class="st">"region1"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2010</span>,   <span class="fl">25</span>,     <span class="st">"region2"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2020</span>,   <span class="fl">10</span>,     <span class="st">"region2"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2030</span>,   <span class="fl">90</span>,     <span class="st">"region2"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Oil"</span>,
     <span class="fl">2010</span>,   <span class="fl">55</span>,     <span class="st">"region1"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2020</span>,   <span class="fl">40</span>,     <span class="st">"region1"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2030</span>,   <span class="fl">30</span>,     <span class="st">"region1"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2010</span>,   <span class="fl">35</span>,     <span class="st">"region2"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2020</span>,   <span class="fl">30</span>,     <span class="st">"region2"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2030</span>,   <span class="fl">32</span>,     <span class="st">"region2"</span>,   <span class="st">"scenA"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2010</span>,   <span class="fl">16</span>,     <span class="st">"region1"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2020</span>,   <span class="fl">28</span>,     <span class="st">"region1"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2030</span>,   <span class="fl">39</span>,     <span class="st">"region1"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2010</span>,   <span class="fl">12</span>,     <span class="st">"region2"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2020</span>,   <span class="fl">26</span>,     <span class="st">"region2"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Gas"</span>,
     <span class="fl">2030</span>,   <span class="fl">37</span>,     <span class="st">"region2"</span>,   <span class="st">"scenB"</span>,  <span class="st">"Gas"</span>
   )

   <span class="no">my_pal</span> <span class="kw">&lt;-</span> <span class="kw pkg">RColorBrewer</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span>(<span class="fl">9</span>, <span class="st">"Set1"</span>)

   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">tbl_multi</span>, <span class="kw">xData</span> <span class="kw">=</span> <span class="st">"x"</span>, <span class="kw">yData</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">class</span><span class="kw">=</span><span class="st">"fuel"</span>,
               <span class="kw">chartType</span> <span class="kw">=</span> <span class="st">"line"</span>,  <span class="kw">classPalette</span><span class="kw">=</span><span class="no">my_pal</span>,
               <span class="kw">facet_rows</span><span class="kw">=</span><span class="st">"region"</span>,<span class="kw">facet_columns</span><span class="kw">=</span><span class="st">"scen"</span>,
               <span class="kw">fileName</span><span class="kw">=</span><span class="st">"chart_eg_line_multi_Set1"</span>,<span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>
               )

   <span class="no">my_pal</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/metis.colors.html">metis.colors</a></span>()$<span class="no">pal_Basic</span>

   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">tbl_multi</span>, <span class="kw">xData</span> <span class="kw">=</span> <span class="st">"x"</span>, <span class="kw">yData</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">class</span><span class="kw">=</span><span class="st">"fuel"</span>, <span class="kw">position</span><span class="kw">=</span><span class="st">"stack"</span>,
               <span class="kw">group</span><span class="kw">=</span><span class="st">"fuel"</span>,<span class="kw">chartType</span> <span class="kw">=</span> <span class="st">"bar"</span>, <span class="kw">classPalette</span><span class="kw">=</span><span class="no">my_pal</span>,
               <span class="kw">facet_rows</span><span class="kw">=</span><span class="st">"region"</span>,<span class="kw">facet_columns</span><span class="kw">=</span><span class="st">"scen"</span>,
               <span class="kw">fileName</span><span class="kw">=</span><span class="st">"chart_eg_barStack_multi_palBasic"</span>,<span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>)

   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">tbl_multi</span>, <span class="kw">xData</span> <span class="kw">=</span> <span class="st">"x"</span>, <span class="kw">yData</span> <span class="kw">=</span> <span class="st">"value"</span>, <span class="kw">class</span><span class="kw">=</span><span class="st">"fuel"</span>, <span class="kw">position</span><span class="kw">=</span><span class="st">"dodge"</span>,
               <span class="kw">group</span><span class="kw">=</span><span class="st">"fuel"</span>,<span class="kw">chartType</span> <span class="kw">=</span> <span class="st">"bar"</span>, <span class="kw">classPalette</span><span class="kw">=</span><span class="no">my_pal</span>,
               <span class="kw">facet_rows</span><span class="kw">=</span><span class="st">"region"</span>,<span class="kw">facet_columns</span><span class="kw">=</span><span class="st">"scen"</span>,
               <span class="kw">fileName</span><span class="kw">=</span><span class="st">"chart_eg_barDodge_multi_Set1"</span>,<span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>)


<span class="co"># Sankey Diagram Example</span>

   <span class="co"># Data Frame with 2 regions, 3 supply sectors and 3 demand sectors and random values</span>
   <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">region</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>),
                    <span class="kw">supplySector</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"coal"</span>,<span class="st">"coal"</span>,<span class="st">"gas"</span>,<span class="st">"gas"</span>,<span class="st">"wind"</span>,<span class="st">"wind"</span>,<span class="st">"coal"</span>,<span class="st">"coal"</span>,<span class="st">"gas"</span>,<span class="st">"gas"</span>,<span class="st">"wind"</span>,<span class="st">"wind"</span>),
                    <span class="kw">demandSector</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"resid"</span>,<span class="st">"indus"</span>,<span class="st">"ag"</span>,<span class="st">"resid"</span>,<span class="st">"ag"</span>,<span class="st">"indus"</span>,<span class="st">"resid"</span>,<span class="st">"indus"</span>,<span class="st">"ag"</span>,<span class="st">"resid"</span>,<span class="st">"indus"</span>,<span class="st">"ag"</span>),
                    <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4.70</span>,<span class="fl">7.33</span>,<span class="fl">9.52</span>,<span class="fl">6.5</span>,<span class="fl">6.70</span>,<span class="fl">3.57</span>,<span class="fl">8.43</span>,<span class="fl">1.68</span>,<span class="fl">7.61</span>,<span class="fl">1.10</span>,<span class="fl">1.58</span>,<span class="fl">3.45</span>)); <span class="no">df</span>

   <span class="fu"><a href="reference/metis.chart.html">metis.chart</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">df</span>, <span class="kw">chartType</span><span class="kw">=</span><span class="st">"sankey"</span>, <span class="kw">yData</span><span class="kw">=</span><span class="st">"value"</span>, <span class="kw">sankeyGroupColor</span><span class="kw">=</span><span class="st">"supplySector"</span>,
               <span class="kw">classLabel</span><span class="kw">=</span><span class="st">"From"</span>, <span class="kw">class</span> <span class="kw">=</span> <span class="st">"supplySector"</span>, <span class="kw">classPalette</span> <span class="kw">=</span> <span class="fu"><a href="reference/metis.colors.html">metis.colors</a></span>()$<span class="no">pal_Basic</span>,
               <span class="kw">sankeyAxis1</span><span class="kw">=</span><span class="st">"supplySector"</span>,<span class="kw">sankeyAxis2</span><span class="kw">=</span><span class="st">"demandSector"</span>,<span class="kw">sankeyAxis1Label</span> <span class="kw">=</span><span class="st">"From"</span>,<span class="kw">sankeyAxis2Label</span><span class="kw">=</span><span class="st">"To"</span>,
               <span class="kw">facet_columns</span><span class="kw">=</span><span class="st">"region"</span>, <span class="kw">fileName</span><span class="kw">=</span><span class="st">"chart_eg_sankey_multi"</span>,<span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>)</pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metischartsprocessr" class="section level2">
<h2 class="hasAnchor">
<a href="#-metischartsprocessr" class="anchor"></a><a name="metis.chartsProcess.R"></a> metis.chartsProcess.R</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p><b> Key Inputs </b></p>
<ul>
<li>rTable: An rTable which can be the output of metis.readgcam() OR/AND</li>
<li>dataTable: A .csv table which can be the original or modified tables produced by metis.readgcam</li>
<li>(Optional) paramsSelect: A subset of the parameters read using the query file.</li>
<li>(Optional) regionsSelect: A subset of the regions available in the data.</li>
<li>(Optional) scenRef: Select a scenario which will be used as a reference to compare differences with other scenarios.</li>
</ul>
<p>After running metis.chartsProcess several charts will be produced. These will be saved in separate folders for each region and then within each there will be a folder for each scenario as well as a folder for cross-scenario comparisons. The folder paths are shown in the figure below. In addition to the individual regional folders a folder called compareRegions will contain inter-regional comparisons for each scenario as well as a cross-region/cross-scenario comparison. Tables with the data used for each figure will also be provided in ./metis/outputs/Charts.</p>
<p align="center">
<b> metis.chartsProcess Example Outputs </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleChart2.PNG"></p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<p align="center">
<b> metis.chartsProcess Output folders </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleChart1.png"></p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="co">#------------------------------------------------------------------------------------------</span>
<span class="co"># Charts Process (metis.chartsProcess.R)</span>
<span class="co">#------------------------------------------------------------------------------------------</span>

<span class="co"># Read in csv tables if available.</span>
  <span class="co"># For example metis.readgcam.R produces datatable and templates which are saved by default in</span>
  <span class="co"># ./metis/outputs/readGCAMTables/Tables_gcam/ for each gcam region selected</span>
  <span class="co"># ./metis/outputs/readGCAMTables/Tables_Templates which gives an example template to fill out with local or other data.</span>
  <span class="co"># Custom or local csv need to have "scenario", "region", "sources",   "param", "units",   "class",    "x",    "value"</span>
  <span class="co"># As an example we are creating a local scenario for Argentina and will save it into Tables_Local.</span>

   <span class="no">localData</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span> (
     ~<span class="no">scenario</span>,    ~<span class="no">region</span>,     ~<span class="no">sources</span>,    ~<span class="no">param</span>,          ~<span class="no">units</span>,               ~<span class="no">class</span>,             ~<span class="no">x</span>,    ~<span class="no">value</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>, <span class="st">"finalNrgbySec"</span>, <span class="st">"Final Energy (TWh)"</span>, <span class="st">"building"</span>,        <span class="st">"2010"</span>, <span class="st">"50"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>, <span class="st">"finalNrgbySec"</span>, <span class="st">"Final Energy (TWh)"</span>, <span class="st">"industry"</span>,        <span class="st">"2010"</span>, <span class="st">"100"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>, <span class="st">"finalNrgbySec"</span>, <span class="st">"Final Energy (TWh)"</span>, <span class="st">"transportation"</span>,  <span class="st">"2010"</span>, <span class="st">"150"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>, <span class="st">"finalNrgbySec"</span>, <span class="st">"Final Energy (TWh)"</span>, <span class="st">"building"</span>,        <span class="st">"2015"</span>, <span class="st">"70"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>, <span class="st">"finalNrgbySec"</span>, <span class="st">"Final Energy (TWh)"</span>, <span class="st">"industry"</span>,        <span class="st">"2015"</span>, <span class="st">"60"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>, <span class="st">"finalNrgbySec"</span>, <span class="st">"Final Energy (TWh)"</span>, <span class="st">"transportation"</span>,  <span class="st">"2015"</span>, <span class="st">"70"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>,  <span class="st">"aggLandAlloc"</span>, <span class="st">"Land Allocation (1000 km^2)"</span>, <span class="st">"crops"</span>,           <span class="st">"2010"</span>, <span class="st">"100"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>,  <span class="st">"aggLandAlloc"</span>, <span class="st">"Land Allocation (1000 km^2)"</span>, <span class="st">"forest"</span>,          <span class="st">"2010"</span>, <span class="st">"200"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>,  <span class="st">"aggLandAlloc"</span>, <span class="st">"Land Allocation (1000 km^2)"</span>, <span class="st">"shrubs"</span>,          <span class="st">"2010"</span>, <span class="st">"30"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>,  <span class="st">"aggLandAlloc"</span>, <span class="st">"Land Allocation (1000 km^2)"</span>, <span class="st">"naturalOther"</span>,    <span class="st">"2010"</span>, <span class="st">"15"</span>,
     <span class="st">"Local Data"</span>, <span class="st">"Argentina"</span>, <span class="st">"Sources"</span>,  <span class="st">"aggLandAlloc"</span>, <span class="st">"Land Allocation (1000 km^2)"</span>, <span class="st">"pasture"</span>,         <span class="st">"2010"</span>, <span class="st">"220"</span>)

   <span class="no">localData</span> <span class="kw">&lt;-</span> <span class="no">localData</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">vintage</span><span class="kw">=</span><span class="st">"Vintage"</span>, <span class="kw">class2</span><span class="kw">=</span><span class="st">"class2"</span>)

   <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))){<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))}
   <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs/Charts"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))){<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs/Charts"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))}
   <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs/Charts/metisExample"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))){<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs/Charts/metisExample"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))}
   <span class="kw pkg">data.table</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html">fwrite</a></span>(<span class="no">localData</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs/Charts/metisExample/example_localFile.csv"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>),<span class="kw">row.names</span> <span class="kw">=</span> <span class="no">F</span>)
   <span class="no">dataTables_i</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"/outputs/Charts/metisExample/example_localFile.csv"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))

<span class="co"># Can also add data .csv outputs from metis.readgcam.R which are autmatically saved in</span>
  <span class="co"># ./metis/outputs/readGCAMTables/Tables_gcam for each of the regions selected.</span>
  <span class="co"># eg. gcamDataTable_Argentina.csv, gcamDataTable_China.csv, gcamDataTable_Pakistan.csv</span>
  <span class="co"># This would be added to dataTables_i as:</span>
  <span class="co"># dataTables_i = c(paste(getwd(), "/example_localFile.csv", sep = ""),</span>
  <span class="co">#                  paste(getwd(), "outputs/readGCAMTables/Tables_gcam/gcamDataTable_Argentina.csv", sep = ""),</span>
  <span class="co">#                  paste(getwd(), "outputs/readGCAMTables/Tables_gcam/gcamDataTable_China.csv", sep = ""),</span>
  <span class="co">#                  paste(getwd(), "outputs/readGCAMTables/Tables_gcam/gcamDataTable_Pakistan.csv", sep = ""))</span>

<span class="co"># Read in the data from the function metis.readgcam.</span>
  <span class="no">rTable_i</span> <span class="kw">&lt;-</span> <span class="no">dataGCAM</span>$<span class="no">data</span>;


<span class="co"># Choose Parameters or set to "All" for all params. For complete list see ?metis.chartsProcess</span>
  <span class="co"># paramsSelect_i=c("finalNrgbySec", "primNrgConsumByFuel", "elecByTech", "elecCapBySubsector",</span>
  <span class="co">#                  "watConsumBySec", "watWithdrawBySec", "watWithdrawByCrop", "watBioPhysCons", "irrWatWithBasin","irrWatConsBasin",</span>
  <span class="co">#                  "gdpPerCapita", "gdp", "gdpGrowthRate", "pop", "agProdbyIrrRfd",</span>
  <span class="co">#                  "agProdBiomass", "agProdForest", "agProdByCrop", "landIrrRfd", "aggLandAlloc",</span>
  <span class="co">#                  "finalNrgbySecDetbyFuel","finalElecbySecDet","finalElecbyServiceDet","finalNrgbySecbyFuel","finalNrgbyFuelbySec",</span>
  <span class="co">#                 "co2emissionBySector","nonco2emissionBySectorGWPAR5","nonco2emissionBySectorGTPAR5","nonco2emissionBySectorOrigUnits")</span>
  <span class="no">paramsSelect_i</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gdp"</span>, <span class="st">"gdpGrowthRate"</span>, <span class="st">"pop"</span>,
                   <span class="st">"finalNrgbySec"</span>,<span class="st">"elecByTech"</span>,
                   <span class="st">"co2emissionBySector"</span>,<span class="st">"nonco2emissionBySectorGWPAR5"</span>,
                   <span class="st">"agProdByCrop"</span>,<span class="st">"aggLandAlloc"</span>,
                   <span class="st">"watConsumBySec"</span>, <span class="st">"watWithdrawBySec"</span>)

<span class="co"># Select regions from the 32 GCAM regions.</span>
  <span class="no">regionsSelect_i</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Argentina"</span>,<span class="st">"Colombia"</span>)

<span class="co"># Charts Process</span>
  <span class="no">charts</span><span class="kw">&lt;-</span><span class="fu"><a href="reference/metis.chartsProcess.html">metis.chartsProcess</a></span>(<span class="kw">rTable</span><span class="kw">=</span><span class="no">rTable_i</span>, <span class="co"># Default is NULL</span>
                          <span class="kw">dataTables</span><span class="kw">=</span><span class="no">dataTables_i</span>, <span class="co"># Default is NULL.</span>
                          <span class="kw">paramsSelect</span><span class="kw">=</span><span class="no">paramsSelect_i</span>, <span class="co"># Default is "All"</span>
                          <span class="kw">regionsSelect</span><span class="kw">=</span><span class="no">regionsSelect_i</span>, <span class="co"># Default is "All"</span>
                          <span class="kw">xCompare</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2015"</span>,<span class="st">"2030"</span>,<span class="st">"2050"</span>,<span class="st">"2100"</span>), <span class="co"># Default is c("2015","2030","2050","2100")</span>
                          <span class="kw">scenRef</span><span class="kw">=</span><span class="st">"Eg1"</span>, <span class="co"># Default is NULL</span>
                          <span class="kw">dirOutputs</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>), <span class="co"># Default is paste(getwd(),"/outputs",sep="")</span>
                          <span class="kw">regionCompareOnly</span><span class="kw">=</span><span class="fl">0</span>, <span class="co"># Default 0. If set to 1, will only run comparison plots and not individual</span>
                          <span class="kw">scenarioCompareOnly</span><span class="kw">=</span><span class="fl">1</span>,
                          <span class="kw">folderName</span> <span class="kw">=</span> <span class="st">"metisExample"</span>) <span class="co"># Default 0. If set to 1, will only run comparison plots and not individual</span></pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metismapr" class="section level2">
<h2 class="hasAnchor">
<a href="#-metismapr" class="anchor"></a><a name="metis.map.R"></a> metis.map.R</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>metis.map.R is the metis charting software used in metis.mapsProcess.R and boundaries. It allows users to map outputs to shapefile polygons and raster. The default settings maintain a conistent look across the metis products.</p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<p>The following section shows some basic example to use metis.map.R.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="co">#-------------------</span>
<span class="co"># Maps (metis.map.R)</span>
<span class="co">#-------------------</span>

<span class="co"># Example 1. Using example Shapefile for US States Provided with metis in ./metis/dataFiles/examples.</span>
  <span class="no">examplePolyFolder</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">examplePolyFile</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"US_states_mainland_ne1"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">exampleUSmainland</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">examplePolyFolder</span>,<span class="kw">layer</span><span class="kw">=</span><span class="no">examplePolyFile</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleUSmainland</span>@<span class="kw">data</span>) <span class="co"># Choose the appropriate column name</span>
  <span class="no">colName_i</span> <span class="kw">=</span> <span class="st">"postal"</span>
  <span class="co"># Categorical Shapefile</span>
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleUSmainland</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">colName_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">labelsAutoPlace</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)
  <span class="co"># Shapefile with values</span>
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleUSmainland</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="st">"latitude"</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">T</span>,
            <span class="kw">legendShow</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">legendOutside</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">fillPalette</span> <span class="kw">=</span> <span class="st">"Spectral"</span>, <span class="kw">labelsAutoPlace</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

<span class="co"># Example 2. using the natural earth Shapefiles provided with metis in ./metis/dataFiles/gis/metis/naturalEarth</span>
  <span class="no">examplePolyFolder</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">examplePolyFile</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne_10m_admin_1_states_provinces"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">exampleNE1</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">examplePolyFolder</span>, <span class="kw">layer</span><span class="kw">=</span><span class="no">examplePolyFile</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleNE1</span>@<span class="kw">data</span>) <span class="co"># Choose the column name</span>
  <span class="no">colName_i</span> <span class="kw">=</span> <span class="st">"name"</span>
  <span class="co"># Crop the shapefile to desired boundary by subsetting</span>
  <span class="no">exampleNE1Cropped</span> <span class="kw">=</span> <span class="no">exampleNE1</span>[<span class="no">exampleNE1</span>$<span class="no">admin</span><span class="kw">==</span><span class="st">"Peru"</span>,]
  <span class="no">exampleNE1Cropped</span>@<span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="no">exampleNE1Cropped</span>@<span class="kw">data</span>)
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">exampleNE1Cropped</span>)
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleNE1Cropped</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">colName_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>,
            <span class="kw">labelsAutoPlace</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

<span class="co"># The cropped shapefile can be saved for later use if desired.</span>
  <span class="co"># Create a directory to save the file to</span>
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))}
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))}
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))}
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample/ExampleShapefile"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample/ExampleShapefile"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))}
  <span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/writeOGR.html">writeOGR</a></span>(<span class="kw">obj</span><span class="kw">=</span><span class="no">exampleNE1Cropped</span>,
                  <span class="kw">dsn</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample/ExampleShapefile"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                  <span class="kw">layer</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Argentina_states_example"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                  <span class="kw">driver</span><span class="kw">=</span><span class="st">"ESRI Shapefile"</span>, <span class="kw">overwrite_layer</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metisboundariesr" class="section level2">
<h2 class="hasAnchor">
<a href="#-metisboundariesr" class="anchor"></a><a name="metis.boundaries.R"></a> metis.boundaries.R</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p><b> Key Inputs </b></p>
<ul>
<li>boundaryRegShape: A polygon shapefile which has already been read into R defining the boundary region. Default is NULL. If left NULL then a folder and filename should be specified if a boundary is desired.</li>
<li>boundaryRegShpFolder: If an extended map is desired then this can be provided. naturalEarth admin boundaries are in ./metis/dataFiles/gis/metis/naturalEarth, The default value is NULL and in this case no extended boundary will be drawn.</li>
<li>boundaryRegShpFile: If desired and chosen from the naturalEarth data then “ne_10m_admin_0_countries” can be chosen.</li>
<li>boundaryRegCol: If boundaryRegShpFolder and File are specified then this column should be specified. If the naturalEarth data is used the column is “NAME”.</li>
<li>boundaryRegionsSelect: Desired boundary region. In the naturalEarth data these are country names eg. “Argentina”,</li>
<li>subRegShape: A polygon shapefile which has already been read into R defining the subregion boundaries. Default is NULL. If left NULL then a folder and filename should be specified.</li>
<li>subRegShpFolder: Folder where subregion shapefile is saved.</li>
<li>subRegShpFile: Name of subregion shapefile.</li>
<li>subRegCol: Column name in shape data which defines the different sub-regions. The sub-region shape file should be read and this column name should be checked.</li>
<li>(Optional) subRegionsSelect: If desired the subregion polygons can be subset by the sub-regions specified here.</li>
<li>subRegType: The kind of sub-region being analyzed e.g. “state”, “subBasin” etc.</li>
<li>nameAppend: If any name should be appended to the files produced e.g. "_hydrobidBermeo3",</li>
<li>extension: If the extended boundary region should be plotted with the subregion.</li>
<li>overlapShpFolder: If an overlapping shapefile is desired then the folder should be specified. For example GCAM basin boundaries saved in ./metis/dataFiles/gis/metis/gcam</li>
<li>overlapShpFile: Overlapping shapefile name for eg. “Global235_CLM_final_5arcmin_multipart”</li>
</ul>
<p>metis.boundaries is used to create maps showing where the sub-region lies in the greater region. For this option a boundary region should be defined. NaturalEarth boundary region files come with the download of Metis. Once metis.boundaries has been run a folder for “Maps” is created. The Maps folder will contain a “Boundary” folder which contains the boundary files defining each region and subregion. The function also shows how different grid cells sizes compare with the selected regions. This is useful to understand if the desired regional resolution is too fine for a particular grid size. The folder structure and example output boundary maps are shown in the figures that follow.</p>
<p align="center">
<b> metis.boundaries Outputs and Example Charts </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleBoundary1.png"></p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<div class="sourceCode" id="cb8"><pre class="r">
<span class="co">#------------</span>
<span class="co"># Boundaries</span>
<span class="co">#------------</span>

<span class="co"># Example 1: Peru</span>
  <span class="no">countryName</span> <span class="kw">=</span> <span class="st">"Peru"</span>
  <span class="no">examplePolyFolder_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">examplePolyFile_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne_10m_admin_1_states_provinces"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">exampleSubRegion</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">examplePolyFolder_i</span>,
                        <span class="kw">layer</span><span class="kw">=</span><span class="no">examplePolyFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegion</span>@<span class="kw">data</span>)
  <span class="no">subRegCol_i</span> <span class="kw">=</span> <span class="st">"name"</span>
  <span class="co"># Crop the shapefile to the desired subRegion</span>
  <span class="no">exampleSubRegionCropped</span><span class="kw">&lt;-</span><span class="no">exampleSubRegion</span>[(<span class="no">exampleSubRegion</span>$<span class="no">admin</span><span class="kw">==</span><span class="no">countryName</span>),]
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegionCropped</span>@<span class="kw">data</span>)
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleSubRegionCropped</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

  <span class="co"># Can Further subset the shapefile if desired</span>
  <span class="no">chosenSubRegions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Cusco"</span>,<span class="st">"Madre de Dios"</span>, <span class="st">"Pasco"</span>)
  <span class="no">exampleSubRegion_chooseState</span><span class="kw">&lt;-</span><span class="no">exampleSubRegionCropped</span>[(<span class="no">exampleSubRegionCropped</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]] <span class="kw">%in%</span> <span class="no">chosenSubRegions</span>),]
  <span class="no">exampleSubRegion_chooseState</span>@<span class="kw">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="no">exampleSubRegion_chooseState</span>@<span class="kw">data</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegion_chooseState</span>@<span class="kw">data</span>)
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleSubRegion_chooseState</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

  <span class="no">exampleBoundaries</span><span class="kw">&lt;-</span> <span class="fu"><a href="reference/metis.boundaries.html">metis.boundaries</a></span>(
                            <span class="kw">boundaryRegShape</span><span class="kw">=</span><span class="kw">NULL</span>,
                            <span class="kw">boundaryRegShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                            <span class="kw">boundaryRegShpFile</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne_10m_admin_0_countries"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                            <span class="kw">boundaryRegCol</span><span class="kw">=</span><span class="st">"ADMIN"</span>,
                            <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">countryName</span>,
                            <span class="kw">subRegShape</span><span class="kw">=</span><span class="no">exampleSubRegionCropped</span>,
                            <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                            <span class="kw">subRegType</span><span class="kw">=</span><span class="st">"state"</span>,
                            <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">"_example"</span>,
                            <span class="kw">expandPercent</span><span class="kw">=</span><span class="fl">2</span>,
                            <span class="kw">overlapShpFile</span><span class="kw">=</span><span class="st">"Global235_CLM_final_5arcmin_multipart"</span>,
                            <span class="kw">overlapShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/gcam"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                            <span class="kw">extension</span> <span class="kw">=</span> <span class="no">T</span>,
                            <span class="kw">grids</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/grids/emptyGrids/grid_025.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                                      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/grids/emptyGrids/grid_050.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)),
                            <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

<span class="co"># Example 2: USA</span>
  <span class="no">countryName</span> <span class="kw">=</span> <span class="st">"United States of America"</span>
  <span class="no">examplePolyFolder_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">examplePolyFile_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"US_states_mainland_ne1_states"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
  <span class="no">exampleSubRegion</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">examplePolyFolder_i</span>,<span class="kw">layer</span><span class="kw">=</span><span class="no">examplePolyFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegion</span>@<span class="kw">data</span>)
  <span class="no">subRegCol_i</span> <span class="kw">=</span> <span class="st">"postal"</span>
  <span class="co"># Crop the shapefile to the desired subRegion</span>
  <span class="no">exampleSubRegionCropped</span><span class="kw">&lt;-</span><span class="no">exampleSubRegion</span>[(<span class="no">exampleSubRegion</span>$<span class="no">admin</span><span class="kw">==</span><span class="no">countryName</span>),]
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegionCropped</span>@<span class="kw">data</span>)
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleSubRegionCropped</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

  <span class="co"># Can Further subset the shapefile if desired</span>
  <span class="no">chosenSubRegions</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CA"</span>,<span class="st">"NV"</span>,<span class="st">"UT"</span>,<span class="st">"CO"</span>,<span class="st">"AZ"</span>,<span class="st">"TX"</span>,<span class="st">"OK"</span>,<span class="st">"WY"</span>,<span class="st">"TX"</span>)
  <span class="no">exampleSubRegion_chooseState</span><span class="kw">&lt;-</span><span class="no">exampleSubRegionCropped</span>[(<span class="no">exampleSubRegionCropped</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]] <span class="kw">%in%</span> <span class="no">chosenSubRegions</span>),]
  <span class="no">exampleSubRegion_chooseState</span>@<span class="kw">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="no">exampleSubRegion_chooseState</span>@<span class="kw">data</span>)
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegion_chooseState</span>@<span class="kw">data</span>)
  <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleSubRegion_chooseState</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>, <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

  <span class="no">exampleBoundaries</span><span class="kw">&lt;-</span> <span class="fu"><a href="reference/metis.boundaries.html">metis.boundaries</a></span>(
                          <span class="kw">boundaryRegShape</span><span class="kw">=</span><span class="kw">NULL</span>,
                          <span class="kw">boundaryRegShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                          <span class="kw">boundaryRegShpFile</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne0_USMainLand_cropped"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                          <span class="kw">boundaryRegCol</span><span class="kw">=</span><span class="st">"ADMIN"</span>,
                          <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">countryName</span>,
                          <span class="kw">subRegShape</span><span class="kw">=</span><span class="no">exampleSubRegionCropped</span>,
                          <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                          <span class="kw">subRegType</span><span class="kw">=</span><span class="st">"state"</span>,
                          <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">"_example"</span>,
                          <span class="kw">expandPercent</span><span class="kw">=</span><span class="fl">10</span>,
                          <span class="kw">overlapShpFile</span><span class="kw">=</span><span class="st">"Global235_CLM_final_5arcmin_multipart"</span>,
                          <span class="kw">overlapShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/gcam"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                          <span class="kw">extension</span> <span class="kw">=</span> <span class="no">T</span>,
                          <span class="co">#grids = c(paste(getwd(),"/dataFiles/grids/emptyGrids/grid_025.csv",sep=""),</span>
                          <span class="co">#          paste(getwd(),"/dataFiles/grids/emptyGrids/grid_050.csv",sep="")),</span>
                          <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)

  <span class="no">exampleBoundaries</span><span class="kw">&lt;-</span> <span class="fu"><a href="reference/metis.boundaries.html">metis.boundaries</a></span>(
                            <span class="kw">boundaryRegShape</span><span class="kw">=</span><span class="kw">NULL</span>,
                            <span class="kw">boundaryRegShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                            <span class="kw">boundaryRegShpFile</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne0_USMainLand_cropped"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                            <span class="kw">boundaryRegCol</span><span class="kw">=</span><span class="st">"ADMIN"</span>,
                            <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">countryName</span>,
                            <span class="kw">subRegShape</span><span class="kw">=</span><span class="no">exampleSubRegion_chooseState</span>,
                            <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                            <span class="kw">subRegType</span><span class="kw">=</span><span class="st">"state"</span>,
                            <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">"_exampleSubset"</span>,
                            <span class="kw">expandPercent</span><span class="kw">=</span><span class="fl">10</span>,
                            <span class="kw">overlapShpFile</span><span class="kw">=</span><span class="st">"Global235_CLM_final_5arcmin_multipart"</span>,
                            <span class="kw">overlapShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/gcam"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                            <span class="kw">extension</span> <span class="kw">=</span> <span class="no">T</span>,
                            <span class="kw">grids</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/grids/emptyGrids/grid_025.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                                      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/grids/emptyGrids/grid_050.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)),
                            <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)</pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metisgrid2polyr" class="section level2">
<h2 class="hasAnchor">
<a href="#-metisgrid2polyr" class="anchor"></a><a name="metis.grid2poly.R"></a> metis.grid2poly.R</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p><b> Key Inputs </b></p>
<ul>
<li>grid: Grid file with lat and lon coordinates.</li>
<li>boundaryRegionsSelect: Name of general region. The model will create a folder for each region.</li>
<li>(Optional) subRegShape: A polygon shapefile which has already been read into R defining the subregion boundaries. Default is NULL. If left NULL then a folder and filename should be specified.</li>
<li>subRegShpFolder: Folder where subregion shapefile is saved.</li>
<li>subRegShpFile: Name of subregion shapefile. If desired and chosen from the naturalEarth data then “ne_10m_admin_1_states_provinces” can be chosen.</li>
<li>subRegCol: Column name in shape data which defines the different sub-regions. The sub-region shape file should be read and this column name should be checked. For the “ne_10m_admin_1_states_provinces” data this name will be “name”</li>
<li>(Optional) subRegionsSelect: If desired the subregion polygons can be subset by the sub-regions specified here.</li>
<li>subRegType: The kind of sub-region being analyzed e.g. “state”, “subBasin” etc.</li>
</ul>
<p>metis.grid2poly is used to aggregate gridded data to given sub-regional spatial scales. Depending on the type of gridded data (volume or depth) the aggregation is done based on the part of the polygon which intersect with the grid cells as shown in the figure below.</p>
<p>metis.grid2poly can also be used to create maps showing where the sub-region lies in the greater region. For this option a boundary region should be defined. NaturalEarth boundary region files come with the download of Metis. Once grid2poly has been run a folder for “Maps” and a folder for “Grids” (if a grid file was provided) are created. Within the Maps folder (./metis/outputs/Maps) the user will find a Tables folder which contains all the data used to create the map as a well as a template for stakeholders to input their own data as a new scenario by sub-region. The Maps folder will also contain a “Boundary” folder which contains the boundary files defining each region and subregion and also includes shapefiles incase these need to be shared with others. The folder structure and example output boundary maps are shown in the figures that follow. If a grid has been provided then a “Grid” folder is also created which contains the cropped gridded data which can be used in for mapping.</p>
<p align="center">
<b> metis.grid2poly metis.grid2poly conceptual aggregation methods </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleGrid2PolySpatAgg.png"></p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="co">#-----------</span>
<span class="co"># Grid to Poly</span>
<span class="co">#-------------</span>

<span class="co"># Example Grid File (csv with lats and lons that overlap the shapefile)</span>
    <span class="no">gridExample</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/examples/example_grid_Peru.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)

<span class="co"># Polygons. An example Shapefile is Provided with metis in ./metis/dataFiles/examples.</span>
    <span class="co"># This is the same file as produced in the boundaries example above.</span>
    <span class="no">examplePolyFolder_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/examples"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">examplePolyFile_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Peru_subRegion_example"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">exampleSubRegionCropped</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">examplePolyFolder_i</span>,
                            <span class="kw">layer</span><span class="kw">=</span><span class="no">examplePolyFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegionCropped</span>@<span class="kw">data</span>) <span class="co"># TO choose subRegCol name</span>
    <span class="no">subRegCol_i</span> <span class="kw">=</span> <span class="st">"name"</span>

<span class="co"># Run metis.grid2poly</span>
    <span class="no">exampleGrid2poly</span><span class="kw">&lt;-</span><span class="fu"><a href="reference/metis.grid2poly.html">metis.grid2poly</a></span>(<span class="kw">grid</span><span class="kw">=</span><span class="no">gridExample</span>,
                                    <span class="kw">subRegShpFolder</span><span class="kw">=</span><span class="no">examplePolyFolder_i</span>,
                                    <span class="kw">subRegShpFile</span><span class="kw">=</span><span class="no">examplePolyFile_i</span>,
                                    <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                                    <span class="co">#aggType="depth", # Aggregation type. Depth or volume. See docuemntation for further details.</span>
                                    <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">"_examplePeru"</span>,
                                    <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>,
                                    <span class="kw">regionName</span> <span class="kw">=</span> <span class="st">"Peru"</span>)</pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-metismapsprocess" class="section level2">
<h2 class="hasAnchor">
<a href="#-metismapsprocess" class="anchor"></a><a name="metis.mapsProcess"></a> metis.mapsProcess</h2>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p><b> Key Inputs </b></p>
<ul>
<li>polygonDataTables: Data table with data per sub-region. This can be an individual table or outputs from metis.grid2poly. The individual table cna be built from the template provided by metis.grid2poly.</li>
<li>gridDataTables: This is gridded data whith lat, lon and values. The outputs from metis.grid2poly can be used or the output can be used as a template to populates user data.</li>
<li>xRange=c(2005,2010,2020): Range of years to analyze. If left blank will analyze all available years.</li>
<li>boundaryRegionsSelect: Name of overall region. Will create a folder with this name. “Argentina”,</li>
<li>(Optional) subRegShape: If a subregional shape is already available in R. If not then the shape folder and file need to be specified in the following paramters.</li>
<li>subRegShpFolder: Sub-region shape file folder. This can be an output of metis.grid2poly and will be lying in ./metis/outputs/Grid2Poly/“REGIONX”. It can also be any subregion shapefile like the ones in “./metis/dataFiles/gis”</li>
<li>subRegShpFile: Sub-region shapefile name e.g. paste(“bermejo3Cropped”,sep=""),</li>
<li>subRegCol: Columns whith unique identifiers for each sub-region. In this case e.g. “SUB_NAME”. The shapefile data should be read and checked to determine this.</li>
<li>subRegType: Name the type of sub-region being analyzed. A separate folder for each type will be create. For exampel “subBasin” or “state”</li>
<li>nameAppend: Any additional names to append to files.</li>
<li>legendPosition: Legend position for freescale maps. Since different shapes may warrant different legend positions. Default is =c(“RIGHT”,“top”).</li>
<li>scenRef: The reference scenario name. All other scenarios will use this as the base for diff maps.</li>
</ul>
<p>After running metis.mapsProcess additional folders are created in the ./metis/outputs/Maps/ folder for each region and sub-region indicated. Within each of these there are plots for each scenario as well as diff plots showing the absolute and percentage difference between the selected reference scenario and all other scenarios. Each map is produced with three kinds of legends Freescale, Kmeans and pretty (or equal breaks) which allow the user to analyze different kinds of data. THe colors schemes for the plots are determined in metis.colors and can be adjusted by advanced users. Animations showing changes through the years are also created for each type of map and legend type. Example of the folder structure and ouputs from metis.mapsProcess are shown below.</p>
<p align="center">
<b> metis.mapsProcess Example Outputs Spatial Scales </b>
</p>
<table class="table">
<thead><tr class="header">
<th align="center">Grid</th>
<th align="center">State</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="READMEfigs/anim_India_raster_griddedScarcityLimit1_Eg1_Local_KMEANS.gif"></td>
<td align="center"><img src="READMEfigs/anim_India_State_griddedScarcityLimit1_Eg1_Local_KMEANS.gif"></td>
</tr></tbody>
</table>
<table class="table">
<thead><tr class="header">
<th align="center">Grid</th>
<th align="center">Basin</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="READMEfigs/anim_India_raster_xanthosRunoff_Eg1_Local_KMEANS.gif"></td>
<td align="center"><img src="READMEfigs/anim_India_State_xanthosRunoff_Eg1_Local_KMEANS.gif"></td>
</tr></tbody>
</table>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="co">#------------------------------</span>
<span class="co"># Mapping (metis.mapsProcess.R)</span>
<span class="co">#------------------------------</span>

<span class="co"># Simple Example. See example csv tables provided for ideal column names needed.</span>
    <span class="no">exampleGridTable_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/examples/example_grid_Peru.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">examplePolygonTable_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/examples/example_poly_Peru.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">gridTable</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">exampleGridTable_i</span>);<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">gridTable</span>)
    <span class="no">polyTable</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">examplePolygonTable_i</span>);<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">polyTable</span>)

    <span class="no">examplePolyFolder_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/examples"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">examplePolyFile_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Peru_subRegion_example"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">exampleSubRegionCropped</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">examplePolyFolder_i</span>,
                                    <span class="kw">layer</span><span class="kw">=</span><span class="no">examplePolyFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">exampleSubRegionCropped</span>@<span class="kw">data</span>) <span class="co"># TO choose subRegCol name</span>
    <span class="no">subRegCol_i</span> <span class="kw">=</span> <span class="st">"name"</span>
    <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">exampleSubRegionCropped</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">F</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>)

    <span class="no">countryName</span><span class="kw">=</span> <span class="st">"Peru"</span>

    <span class="fu"><a href="reference/metis.mapsProcess.html">metis.mapsProcess</a></span>(<span class="kw">polygonDataTables</span><span class="kw">=</span><span class="no">examplePolygonTable_i</span>,
                 <span class="kw">gridDataTables</span><span class="kw">=</span><span class="no">exampleGridTable_i</span>,
                 <span class="kw">xRange</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2005</span>,<span class="fl">2010</span>,<span class="fl">2015</span>,<span class="fl">2020</span>,<span class="fl">2025</span>,<span class="fl">2030</span>),
                 <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>,
                 <span class="kw">boundaryRegShpFolder</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                 <span class="kw">boundaryRegShpFile</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne_10m_admin_0_countries"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>),
                 <span class="kw">boundaryRegCol</span><span class="kw">=</span><span class="st">"NAME"</span>,
                 <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">countryName</span>,
                 <span class="kw">subRegShape</span><span class="kw">=</span><span class="kw">NULL</span>,
                 <span class="kw">subRegShpFolder</span><span class="kw">=</span><span class="no">examplePolyFolder_i</span>,
                 <span class="kw">subRegShpFile</span><span class="kw">=</span><span class="no">examplePolyFile_i</span>,
                 <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                 <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">"_exampleSubRegionMap"</span>,
                 <span class="kw">legendPosition</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"LEFT"</span>,<span class="st">"bottom"</span>),
                 <span class="kw">animateOn</span><span class="kw">=</span><span class="no">T</span>,
                 <span class="kw">delay</span><span class="kw">=</span><span class="fl">100</span>,
                 <span class="kw">scenRef</span><span class="kw">=</span><span class="st">"Eg1"</span>,
                 <span class="kw">expandPercent</span> <span class="kw">=</span> <span class="fl">2</span>,
                 <span class="kw">extension</span><span class="kw">=</span><span class="no">T</span>)


<span class="co">#--------------------------------------------------</span>
<span class="co"># Mapping (metis.mapsProcess.R) - Extensive Example</span>
<span class="co">#--------------------------------------------------</span>
    <span class="co"># Steps</span>
    <span class="co"># Read in the boundary Shapefile to crop underlying data to.</span>
    <span class="co"># Choose the boundary region name or names to subset the boundary shapefile.</span>
    <span class="co"># Read in sub-region shape file (Example the GCAM Basins shapefile)</span>
    <span class="co"># Run metis.boundaries.R to crop the sub-region shapefile to the boudnary region selected.</span>
    <span class="co"># Read in polygon data table with data per sub-regions of interest</span>
    <span class="co"># Runs metis.mapsProcess.R</span>

<span class="co"># Read in Boundary Region</span>
    <span class="co"># Read in the GCAM 32 regions shapefile which comes with metis.</span>
    <span class="no">boundaryRegShpFolder_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/gcam"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">boundaryRegShpFile_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"region32_0p5deg_regions"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">boundaryRegShp_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">boundaryRegShpFolder_i</span>,<span class="kw">layer</span><span class="kw">=</span><span class="no">boundaryRegShpFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">boundaryRegShp_i</span>@<span class="kw">data</span>)
    <span class="no">boundaryRegCol_i</span> <span class="kw">=</span> <span class="st">"region"</span>
    <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">boundaryRegShp_i</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">boundaryRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">F</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>)

    <span class="co"># Choose GCAM region</span>
    <span class="co"># Full list: USA, Africa_Eastern, Africa_Northern, Africa_Southern, Africa_Western,</span>
    <span class="co"># Australia_NZ, Brazil, Canada Central America and Caribbean, Central Asia, China, EU-12,</span>
    <span class="co"># EU-15, Europe_Eastern, Europe_Non_EU, European Free Trade Association, India, Indonesia, Japan,</span>
    <span class="co"># Mexico, Middle East, Pakistan, Russia, South Africa, South America_Northern, South America_Southern,</span>
    <span class="co"># South Asia, South Korea, Southeast Asia,</span>

<span class="co"># A similar analysis can be done using the country shapefile for any country.</span>
    <span class="co"># Uncomment the following lines of code and choose and appropriate region to crop to.</span>
    <span class="co"># boundaryRegShpFolder_i &lt;- paste(getwd(),"/dataFiles/gis/metis/naturalEarth",sep="")</span>
    <span class="co"># boundaryRegShpFile_i &lt;- paste("ne_10m_admin_0_countries",sep="")</span>
    <span class="co"># boundaryRegShp_i = readOGR(dsn=boundaryRegShpFolder_i,layer=boundaryRegShpFile_i,use_iconv=T,encoding='UTF-8')</span>
    <span class="co"># head(boundaryRegShp_i@data)</span>
    <span class="co"># boundaryRegCol_i = "NAME"</span>
    <span class="co"># metis.map(dataPolygon=boundaryRegShp_i,fillColumn = boundaryRegCol_i,labels=F ,printFig=F,facetsON=F)</span>
    <span class="co"># Pick country names from the list of countries in the natural earth shapefile.</span>
    <span class="co"># unique(boundaryRegShp_i@data[[boundaryRegCol_i]])</span>

    <span class="no">boundaryRegionsSelect_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>) <span class="co"># Must be a region in the boundaryRegShp</span>


<span class="co"># Read in subregion shapefile</span>
    <span class="co"># Read in the  SubBasin GCAM Basins shapefile which comes with metis.</span>
    <span class="no">subRegShpFolder_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/gcam"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">subRegShpFile_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Global235_CLM_final_5arcmin_multipart"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">subRegShp_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">subRegShpFolder_i</span>,<span class="kw">layer</span><span class="kw">=</span><span class="no">subRegShpFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">subRegShp_i</span>@<span class="kw">data</span>)
    <span class="no">subRegCol_i</span> <span class="kw">=</span> <span class="st">"basin_name"</span>
    <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">subRegShp_i</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">F</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>)

<span class="co"># Run metis.boundaries on the two shapefiles and selected region to get the cropped shapefile.</span>
    <span class="no">boundaries</span><span class="kw">&lt;-</span> <span class="fu"><a href="reference/metis.boundaries.html">metis.boundaries</a></span>(
      <span class="kw">boundaryRegShape</span><span class="kw">=</span><span class="no">boundaryRegShp_i</span>,
      <span class="kw">boundaryRegCol</span><span class="kw">=</span><span class="no">boundaryRegCol_i</span>,
      <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">boundaryRegionsSelect_i</span>,
      <span class="kw">subRegShape</span><span class="kw">=</span><span class="no">subRegShp_i</span>,
      <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
      <span class="kw">subRegType</span><span class="kw">=</span><span class="st">"GCAMBasin"</span>,
      <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">""</span>,
      <span class="kw">expandPercent</span><span class="kw">=</span><span class="fl">2</span>,
      <span class="co">#overlapShpFile="Global235_CLM_final_5arcmin_multipart",</span>
      <span class="co">#overlapShpFolder=paste(getwd(),"/dataFiles/gis/metis/gcam",sep=""),</span>
      <span class="kw">extension</span> <span class="kw">=</span> <span class="no">T</span>,
      <span class="kw">cropSubShape2Bound</span> <span class="kw">=</span> <span class="no">T</span>,
      <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample"</span>)


<span class="co"># The subregion shapefile created by boundaries can now be selected to be used for mapping values.</span>
    <span class="no">subRegShp_i_Crop</span> <span class="kw">=</span> <span class="no">boundaries</span>$<span class="no">subRegShape</span> <span class="co"># or can point to the subRegShapeFolder and subRegShpFile as produced by metis.boundaries.R</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span>); <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]])
    <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">subRegShp_i_Crop</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>)
    <span class="co"># Sometimes the cropping results in slivers of regions left around boundaries when the boundayr and subregion shape don't line up.</span>
    <span class="co"># The extra regions can be removed as follows.</span>
    <span class="co"># Choose regions from the list of regions printed above.</span>
    <span class="co"># Can also subset to the regions available in the polygon data table below.(unique(polyTable$subRegion)</span>
    <span class="no">regions_to_remove</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Amu_Darya"</span>)
    <span class="no">subRegShp_i_Crop</span><span class="kw">&lt;-</span><span class="no">subRegShp_i_Crop</span>[(!<span class="no">subRegShp_i_Crop</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]] <span class="kw">%in%</span> <span class="no">regions_to_remove</span>) <span class="kw">&amp;</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">subRegShp_i_Crop</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]]),]
    <span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span>); <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]])
    <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">subRegShp_i_Crop</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">subRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">T</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>)


<span class="co"># Read in the datatable with values by subRegion</span>
    <span class="no">examplePolygonTable_i</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/examples/example_GCAMBasins_analysis.csv"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">polyTable</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="no">examplePolygonTable_i</span>);<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">polyTable</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">polyTable</span>$<span class="no">x</span>); <span class="co"># check available number of years.</span>

    <span class="co"># Make sure shapefile subRegions and PolygonTable subregions match</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">polyTable</span>$<span class="no">subRegion</span>); <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">subRegShp_i_Crop</span>@<span class="kw">data</span><span class="kw">[[</span><span class="no">subRegCol_i</span>]])

    <span class="fu"><a href="reference/metis.mapsProcess.html">metis.mapsProcess</a></span>(<span class="kw">polygonDataTables</span><span class="kw">=</span><span class="no">examplePolygonTable_i</span>,
                     <span class="co">#gridDataTables=exampleGridTable_i,</span>
                     <span class="kw">xRange</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2010</span>,<span class="fl">2020</span>,<span class="fl">2030</span>,<span class="fl">2040</span>,<span class="fl">2050</span>),
                     <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample_extended"</span>,
                     <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">boundaryRegionsSelect_i</span>,
                     <span class="kw">boundaryRegShape</span><span class="kw">=</span><span class="no">boundaryRegShp_i</span>,
                     <span class="kw">subRegShape</span><span class="kw">=</span><span class="no">subRegShp_i_Crop</span>,
                     <span class="kw">boundaryRegCol</span> <span class="kw">=</span> <span class="no">boundaryRegCol_i</span>,
                     <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                     <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">""</span>,
                     <span class="kw">animateOn</span><span class="kw">=</span><span class="no">T</span>,
                     <span class="kw">delay</span><span class="kw">=</span><span class="fl">100</span>,
                     <span class="kw">scenRef</span><span class="kw">=</span><span class="st">"SSP2_Ref"</span>,
                     <span class="kw">extension</span><span class="kw">=</span><span class="no">F</span>,
                     <span class="kw">diffOn</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="co"># Improved map using available parameters.</span>
    <span class="co"># Shift legend outside and change the scale_range to get conistent scale across scenarios.</span>

<span class="co"># Set scale ranges across scenarios to be the same.</span>
    <span class="co"># Check range of data for each param</span>
    <span class="kw">for</span>(<span class="no">param_i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">polyTable</span>$<span class="no">param</span>)){
      <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"param: "</span>, <span class="no">param_i</span>, <span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>));<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Range is:"</span>)
      <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>((<span class="no">polyTable</span><span class="kw">%&gt;%</span><span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">param</span><span class="kw">==</span><span class="no">param_i</span>))$<span class="no">value</span>))}

    <span class="no">scaleRange_i</span> <span class="kw">=</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
      ~<span class="no">param</span>,~<span class="no">minScale</span>, ~<span class="no">maxScale</span>,
      <span class="st">"waterConsumption"</span>, <span class="fl">0</span>, <span class="fl">60</span>)

<span class="co"># Select natural Earth country Map</span>
    <span class="no">boundaryRegShpFolder_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/dataFiles/gis/metis/naturalEarth"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">boundaryRegShpFile_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ne_10m_admin_0_countries"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)
    <span class="no">boundaryRegShp_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="kw">dsn</span><span class="kw">=</span><span class="no">boundaryRegShpFolder_i</span>,<span class="kw">layer</span><span class="kw">=</span><span class="no">boundaryRegShpFile_i</span>,<span class="kw">use_iconv</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">encoding</span><span class="kw">=</span><span class="st">'UTF-8'</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">boundaryRegShp_i</span>@<span class="kw">data</span>)
    <span class="no">boundaryRegCol_i</span> <span class="kw">=</span> <span class="st">"NAME"</span>
    <span class="fu"><a href="reference/metis.map.html">metis.map</a></span>(<span class="kw">dataPolygon</span><span class="kw">=</span><span class="no">boundaryRegShp_i</span>,<span class="kw">fillColumn</span> <span class="kw">=</span> <span class="no">boundaryRegCol_i</span>,<span class="kw">labels</span><span class="kw">=</span><span class="no">F</span> ,<span class="kw">printFig</span><span class="kw">=</span><span class="no">F</span>,<span class="kw">facetsON</span><span class="kw">=</span><span class="no">F</span>)
    <span class="no">boundaryRegionsSelect_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"China"</span>)

    <span class="fu"><a href="reference/metis.mapsProcess.html">metis.mapsProcess</a></span>(<span class="kw">polygonDataTables</span><span class="kw">=</span><span class="no">examplePolygonTable_i</span>,
                     <span class="co">#gridDataTables=exampleGridTable_i,</span>
                     <span class="kw">xRange</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2010</span>,<span class="fl">2020</span>,<span class="fl">2030</span>,<span class="fl">2040</span>,<span class="fl">2050</span>),
                     <span class="kw">folderName</span><span class="kw">=</span><span class="st">"metisExample_extendedRefined"</span>,
                     <span class="kw">boundaryRegionsSelect</span><span class="kw">=</span><span class="no">boundaryRegionsSelect_i</span>,
                     <span class="kw">boundaryRegShape</span><span class="kw">=</span><span class="no">boundaryRegShp_i</span>,
                     <span class="kw">boundaryRegCol</span> <span class="kw">=</span> <span class="no">boundaryRegCol_i</span>,
                     <span class="kw">subRegShape</span><span class="kw">=</span><span class="no">subRegShp_i_Crop</span>,
                     <span class="kw">subRegCol</span><span class="kw">=</span><span class="no">subRegCol_i</span>,
                     <span class="kw">nameAppend</span><span class="kw">=</span><span class="st">"_improvedFig"</span>,
                     <span class="kw">legendPosition</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"LEFT"</span>,<span class="st">"bottom"</span>),
                     <span class="kw">animateOn</span><span class="kw">=</span><span class="no">T</span>,
                     <span class="kw">delay</span><span class="kw">=</span><span class="fl">100</span>,
                     <span class="kw">scenRef</span><span class="kw">=</span><span class="st">"SSP2_Ref"</span>,
                     <span class="kw">extension</span><span class="kw">=</span><span class="no">T</span>,
                     <span class="kw">diffOn</span> <span class="kw">=</span> <span class="no">T</span>,
                     <span class="kw">legendOutsideSingle</span> <span class="kw">=</span> <span class="no">T</span>,
                     <span class="kw">scaleRange</span> <span class="kw">=</span> <span class="no">scaleRange_i</span>)</pre></div>
<p align="center">
<b> metis.mapsProcess Example Output Data Scales </b>
</p>
<p align="center">
<img src="READMEfigs/metis_moduleMapsProcess1.png"></p>

</details><!-- ------------------------><!-- ------------------------>
</div>
</div>
<div id="-testing" class="section level1">
<h1 class="hasAnchor">
<a href="#-testing" class="anchor"></a><a name="Testing"></a> Testing</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>metis.master.R allows users to test all the keys functionality of metis. At the end of metis.master.R a section on testing checks if the expected output was produced for each of the sections presented. A final line at the end of the script gives a summary of these test results.</p>
<details><summary>Click here to expand for further details, code and example figures.</summary><p>
</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="co">#------------------------------</span>
<span class="co"># Metis Tests (Check if outputs from metis.master.R are working as expected)</span>
<span class="co">#------------------------------</span>

    <span class="co"># Test: Install Packages Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"devtools"</span>,<span class="st">"rgcam"</span>,<span class="st">"metis"</span>,<span class="st">"rgdal"</span>,<span class="st">"magick"</span>) <span class="kw">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html">installed.packages</a></span>()))<span class="kw">==</span><span class="no">T</span>){
      <span class="no">testInstallPackages</span> <span class="kw">=</span> <span class="st">"Test Install Packages: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testInstallPackages</span> <span class="kw">=</span> <span class="st">"Test Install Packages: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testInstallPackages</span>)

    <span class="co"># Test: IO Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">io</span>$<span class="no">A</span>)<span class="kw">&gt;</span><span class="fl">1</span> <span class="kw">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">io_sub</span>$<span class="no">A</span>)<span class="kw">&gt;</span><span class="fl">1</span>){
      <span class="no">testIO</span> <span class="kw">=</span> <span class="st">"Test IO: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testIO</span> <span class="kw">=</span> <span class="st">"Test IO: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testIO</span>)

    <span class="co"># Test: readgcam Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">dataGCAM</span>$<span class="no">data</span>)<span class="kw">&gt;</span><span class="fl">1</span>){
      <span class="no">testReadGCAM</span> <span class="kw">=</span> <span class="st">"Test readGCAM: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testReadGCAM</span> <span class="kw">=</span> <span class="st">"Test readGCAM: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testReadGCAM</span>)

    <span class="co"># Test: charts Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/charts/metisExample/chart_eg_line_multi_Set1.png"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)) <span class="kw">&amp;</span>
       <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/charts/metisExample/chart_eg_sankey_multi.png"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){
      <span class="no">testChart</span> <span class="kw">=</span> <span class="st">"Test chart: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testChart</span> <span class="kw">=</span> <span class="st">"Test chart: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testChart</span>)

    <span class="co"># Test: chartsProcess Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/charts/metisExample/compareRegions/ArgentinaColombiaEg1/aggLandAlloc_figBar_Eg1_compareRegions.png"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)) <span class="kw">&amp;</span>
       <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/charts/metisExample/Colombia/compareScen/agProdByCrop_figLineDiff_Colombia_compareScen.png"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){
      <span class="no">testChartsProcess</span> <span class="kw">=</span> <span class="st">"Test chartsProcess: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testChartsProcess</span> <span class="kw">=</span> <span class="st">"Test chartsProcess: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testChartsProcess</span>)

    <span class="co"># Test: map Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample/map.png"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){
      <span class="no">testMap</span> <span class="kw">=</span> <span class="st">"Test map: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testMap</span> <span class="kw">=</span> <span class="st">"Test map: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testMap</span>)

    <span class="co"># Test: boundary Check</span>
    <span class="kw">if</span>(<span class="no">exampleBoundaries</span>$<span class="no">subRegShape</span>$<span class="no">admin</span>[<span class="fl">1</span>]<span class="kw">==</span><span class="st">"United States of America"</span>){
      <span class="no">testBoundary</span> <span class="kw">=</span> <span class="st">"Test boundary: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testBoundary</span> <span class="kw">=</span> <span class="st">"Test boundary: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testBoundary</span>)

    <span class="co"># Test: grid2Poly Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">exampleGrid2poly</span>)<span class="kw">&gt;</span><span class="fl">1</span>){
      <span class="no">testGrid2Poly</span> <span class="kw">=</span> <span class="st">"Test grid2Poly: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testGrid2Poly</span> <span class="kw">=</span> <span class="st">"Test grid2Poly: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testGrid2Poly</span>)

    <span class="co"># Test: mapsProcess Check</span>
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample/subRegType/Eg1/byYear/map_metisExample_subRegType_tethysWatWithdraw_indv_2030_Eg1_exampleSubRegionMap_FREESCALE.png"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>)) <span class="kw">&amp;</span>
       <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),<span class="st">"/outputs/Maps/metisExample/subRegType/Eg1/anim_metisExample_subRegType_tethysWatWithdraw_indv_Eg1_exampleSubRegionMap_FREESCALE.gif"</span>,<span class="kw">sep</span><span class="kw">=</span><span class="st">""</span>))){
      <span class="no">testMapsProcess</span> <span class="kw">=</span> <span class="st">"Test mapsProcess: Passed"</span>
    } <span class="kw">else</span> { <span class="no">testMapsProcess</span> <span class="kw">=</span> <span class="st">"Test mapsProcess: Failed"</span>}; <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">testMapsProcess</span>)

    <span class="no">metisTests</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Test</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">testInstallPackages</span>,<span class="no">testIO</span>,<span class="no">testReadGCAM</span>,
                                   <span class="no">testChart</span>,<span class="no">testChartsProcess</span>,<span class="no">testMap</span>,<span class="no">testBoundary</span>,
                                   <span class="no">testGrid2Poly</span>,<span class="no">testMapsProcess</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">metisTests</span>)
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Failed"</span>,<span class="no">metisTests</span>$<span class="no">Test</span>))){<span class="st">"Some metis tests failed. Please check the relevant section."</span>} <span class="kw">else</span> {<span class="st">"All metis tests passed without issues."</span>}</pre></div>

</details><!-- ------------------------><!-- ------------------------>
</div>
<div id="-under-development" class="section level1">
<h1 class="hasAnchor">
<a href="#-under-development" class="anchor"></a><a name="underDevelopment"></a> Under development</h1>
<p align="center">
<img src="READMEfigs/metisHeaderThick.PNG"></p>
<!-- ------------------------>
<!-- ------------------------>
<p><a href="#Contents">Back to Contents</a></p>
<p>This section describes functions currently under development. Comments and suggestions are welcome. Functions under development include:</p>
<ul>
<li>metis.networkOrder.R: Determines the order in which to route water flows through the network of sub-regions, given a user-specified network connectivity matrix.</li>
<li>metis.waterBalance.R: Determines the natural flows from upstream sub-regions to downstream sub-regions via routing.</li>
</ul>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Zarrar Khan <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Zarrar Khan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
